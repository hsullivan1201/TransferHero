<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>TransferHero - DC Metro Transfer Assistant</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="json-box.css" />
    <link rel="stylesheet" href="style.css" />

    <!-- Metro data files -->
    <script src="data/stations.js"></script>
    <script src="data/transfers.js"></script>
    <script src="data/travel-times.js"></script>
    <script src="data/car-positions.js"></script>
    <script src="data/line-config.js"></script>
    <script src="schedule-data.js"></script>

    <!-- API Configuration -->
    <script src="config.js"></script>
  </head>
  <body>
    <!-- Compact Header -->
    <header class="hero-compact text-center">
      <div class="container d-flex align-items-center justify-content-center gap-3">
        <h1 class="fw-bold">
          <i class="fas fa-train-subway"></i>
          TransferHero
        </h1>
        <span class="tagline text-muted">DC Metro transfers</span>
        <div class="ms-auto d-flex gap-2">
          <button id="theme-toggle" class="btn btn-outline-secondary btn-sm" onclick="toggleTheme()" title="Toggle dark/light mode">
            <span id="theme-icon"><i class="fas fa-moon"></i></span>
          </button>
          <button class="btn btn-outline-secondary btn-sm" onclick="refreshGTFS()" title="Update GTFS">
            <i class="fas fa-sync-alt me-1"></i> Refresh Data
          </button>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="container py-3">
      <!-- Station Selector -->
      <section class="trip-selector mb-3">
        <div class="card shadow-sm">
          <div class="card-body py-3">
            <div class="row g-2 align-items-end">
              <!-- From Station -->
              <div class="col-md-4">
                <label class="form-label fw-semibold mb-1 small">
                  <i class="fas fa-location-dot me-1"></i> From
                </label>
                <div class="station-input-wrapper">
                  <div class="station-input-container">
                    <input type="text" id="from-station" class="form-control" placeholder="Type station name..." autocomplete="off" oninput="onStationInput('from')" onfocus="onStationFocus('from')" onblur="onStationBlur('from')">
                    <input type="hidden" id="from-station-code">
                    <div id="from-suggestions" class="station-suggestions"></div>
                  </div>
                </div>
              </div>

              <!-- To Station -->
              <div class="col-md-4">
                <label class="form-label fw-semibold mb-1 small">
                  <i class="fas fa-flag-checkered me-1"></i> To
                </label>
                <div class="station-input-wrapper">
                  <div class="station-input-container">
                    <input type="text" id="to-station" class="form-control" placeholder="Type station name..." autocomplete="off" oninput="onStationInput('to')" onfocus="onStationFocus('to')" onblur="onStationBlur('to')">
                    <input type="hidden" id="to-station-code">
                    <div id="to-suggestions" class="station-suggestions"></div>
                  </div>
                </div>
              </div>

              <!-- Transfer Walk Time -->
              <div class="col-md-2">
                <label class="form-label fw-semibold mb-1 small">
                  <i class="fas fa-person-walking me-1"></i> Walk
                </label>
                <div class="input-group input-group-sm">
                  <input type="number" id="transfer-walk-time" class="form-control" value="3" min="1" max="15" onchange="updateTransferTime()">
                  <span class="input-group-text">min</span>
                </div>
              </div>

              <!-- Go Button -->
              <div class="col-md-2">
                <button id="go-button" class="btn btn-primary w-100" onclick="startTrip()" disabled>
                  <i class="fas fa-arrow-right me-1"></i> Go
                </button>
              </div>
            </div>

            <div id="transfer-station-display" class="mt-2 text-muted small text-center" style="display: none;">
              <i class="fas fa-arrows-turn-right me-1"></i>
              Transfer at: <strong id="transfer-station-name">Metro Center</strong>
            </div>
          </div>
        </div>
      </section>

      <!-- Train Display Sections -->
      <div class="row g-3" id="train-sections" style="display: none;">
        <!-- First Leg -->
        <div class="col-md-5">
          <div class="card shadow-sm h-100">
            <div class="card-header bg-dark text-white py-2">
              <h6 class="mb-0">
                <span class="badge bg-secondary me-2">1</span>
                <span id="leg1-title">First Leg</span>
              </h6>
              <small class="text-light opacity-75" id="leg1-subtitle">Starting station</small>
            </div>
            <div class="card-body py-2">
              <div id="train-info1" class="train-list">
                <div class="placeholder-message text-muted text-center py-4">
                  <span class="spinner-border spinner-border-sm me-2"></span>
                  Loading trains...
                </div>
              </div>
              <!-- Car Diagram for Boarding -->
              <div id="car-diagram-1" class="car-diagram" style="display: none;">
                <div class="car-diagram-title">
                  <i class="fas fa-train me-1"></i> Board here for fastest transfer
                </div>
                <div class="car-row" id="car-row-1"></div>
                <div class="car-legend" id="car-legend-1"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Journey Info (middle) -->
        <div class="col-md-2 d-flex align-items-center">
          <div id="journey-info" class="journey-info text-center w-100" style="display: none;">
            <div class="journey-arrow">
              <i class="fas fa-arrow-right"></i>
            </div>
            <div class="journey-detail">
              <span class="journey-label">
                <i class="fas fa-train-subway"></i> Travel
              </span>
              <span class="journey-value" id="travel-time">--</span>
            </div>
            <div class="journey-detail">
              <span class="journey-label">
                <i class="fas fa-person-walking"></i> Transfer
              </span>
              <span class="journey-value" id="transfer-time">--</span>
            </div>
            <div class="journey-total">
              <span class="journey-label">
                <i class="fas fa-clock"></i> Total
              </span>
              <span class="journey-value" id="total-time">--</span>
            </div>
          </div>
        </div>

        <!-- Transfer Leg -->
        <div class="col-md-5">
          <div class="card shadow-sm h-100">
            <div class="card-header bg-dark text-white py-2">
              <h6 class="mb-0">
                <span class="badge bg-success me-2">2</span>
                <span id="leg2-title">Transfer</span>
              </h6>
              <small class="text-light opacity-75" id="leg2-subtitle">Transfer station</small>
            </div>
            <div class="card-body py-2">
              <div id="train-info2" class="train-list">
                <div class="placeholder-message text-muted text-center py-4">
                  <span class="spinner-border spinner-border-sm me-2"></span>
                  Loading trains...
                </div>
              </div>
              <!-- Car Diagram for Exit -->
              <div id="car-diagram-2" class="car-diagram" style="display: none;">
                <div class="car-diagram-title">
                  <i class="fas fa-door-open me-1"></i> Exit here for destination
                </div>
                <div class="car-row" id="car-row-2"></div>
                <div class="car-legend" id="car-legend-2"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div id="empty-state" class="text-center py-5">
        <div class="empty-state-icon mb-3">
          <i class="fas fa-train-subway fa-4x text-muted"></i>
        </div>
        <h4 class="text-muted">Select a trip to see train times</h4>
        <p class="text-muted small">Real-time predictions from WMATA</p>
      </div>
    </main>

    <!-- Footer -->
    <footer class="text-center py-3 mt-4">
      <small class="text-muted">
        <i class="fas fa-bolt me-1"></i> Powered by WMATA API | Data refreshes on selection
      </small>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <!-- Main application logic -->
    <script src="app.js"></script>
  </body>
</html>
